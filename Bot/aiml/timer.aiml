<?xml version='1.0' encoding='UTF-8'?>
<aiml version='2.1'>
	<category>
		<pattern>ReadTimerAsync *</pattern>
		<template>
			<condition name='timerslot'>
				<li value='*'><srai>SelectFaceAsync ReadTimer <star/> XS <srai>XSlotFace <get name='timerslot'/></srai> XS true</srai></li>
				<li>Don't know where the timer is.</li>
			</condition>
		</template>
	</category>
	<category>
		<pattern>SelectFaceDone ReadTimer *</pattern>
		<template><srai>OOB Tick ReadTimerSingleRead <star/> XS nil</srai></template>
	</category>
	<category>
		<pattern>OOB Tick ReadTimerSingleRead *</pattern>
		<template>
			<oob><takescreenshot><token>ReadTimer <star/></token></takescreenshot></oob>
		</template>
	</category>
	<category>
		<pattern>OOB ScreenshotReady ReadTimer * XS * *</pattern>
		<template>
			<think><set var='coords'><rest><get name='timerslot'/></rest></set></think>
			<srai>ReadTimerResult <star/> XS <star index='2'/> XS <sraix service='BombDefuserAimlService'>Timer <star index='3'/> <srai>GetPoints <get name='timerslot'/></srai></sraix></srai>
		</template>
	</category>
	<category>
		<pattern>ReadTimerResult * XS nil XS * * * *</pattern>
		<template>
			<!-- Keep watching the timer until it ticks over to get sub-second precision. -->
			<oob><timer duration='0.1'><postback>ReadTimerSingleRead <star/> XS <star index='3'/></postback></timer></oob>
		</template>
	</category>
	<category>
		<pattern>ReadTimerResult * XS * XS * * * *</pattern>
		<template>
			<think>
				<set var='lastSeconds'><star index='2'/></set>
				<set name='gamemode'><star index='3'/></set>
			</think>
			<condition var='lastSeconds'>
				<li><value><star index='4'/></value><oob><timer duration='0.1'><postback>ReadTimerSingleRead <star/> XS <star index='4'/></postback></timer></oob></li>
				<li>
					<think>
						<condition name='gamemode'>
							<li value='Zen'><set name='timer'><star index='4'/></set></li>
							<li><set name='timer'><get var='lastSeconds'/></set></li>
						</condition>
						<set name='timerstamp'><calculate><sraix service='TimestampService'>ms</sraix> - 50</calculate></set>
					</think>
					<srai>ReadTimerDone <star/></srai>
				</li>
			</condition>
		</template>
	</category>

	<category>
		<pattern>GetTimerMs</pattern>
		<template>
			<condition name='timer'>
				<li value='*'>
					<condition name='gamemode'>
						<li value='zen'>
							<calculate><get name='timer'/> * 1000 + (<sraix service='TimestampService'>ms</sraix> - <get name='timerstamp'/>)</calculate>
						</li>
						<li>
							<calculate><get name='timer'/> * 1000 - (<sraix service='TimestampService'>ms</sraix> - <get name='timerstamp'/>)</calculate>
						</li>
					</condition>
				</li>
				<li>unknown</li>
			</condition>
		</template>
	</category>

	<category>
		<pattern>WaitForDigitInTimerAsync * XS *</pattern>
		<template>
			<think>
				<set var='time'><srai>GetTimerMs</srai></set>
				<set var='d3'><calculate><get var='time'/> \ 600000 % 10</calculate></set>
				<set var='d2'><calculate><get var='time'/> \ 60000 % 10</calculate></set>
				<set var='d1'><calculate><get var='time'/> \ 10000 % 10</calculate></set>
				<set var='d0'><calculate><get var='time'/> \ 1000 % 10</calculate></set>
				<set var='c'><srai>XContains <star index='2'/> XS <get var='d3'/> <get var='d2'/> <get var='d1'/> <get var='d0'/></srai></set>
			</think>
			<condition var='c'>
				<li value='true'><srai>WaitForDigitInTimerDone <star/></srai></li>
				<li>
					<!-- TODO: This will only consider the seconds digit for now. -->
					<condition name='gamemode'>
						<li value='normal'></li>
						<li>
							<think><set var='c'><srai>XCompareDigits <get var='d0'/> XS <star index='2'/></srai></set></think>
							<condition var='c'>
								<li value='1'>
									<oob><timer><duration><calculate>(<star index='2'/> * 1000 + 10500 - <get var='time'/> % 10000) / 1000</calculate></duration><postback>WaitForDigitInTimer <star/></postback></timer></oob>
								</li>
								<li>
									<oob><timer><duration><calculate>(<star index='2'/> * 1000 + 500 - <get var='time'/> % 10000) / 1000</calculate></duration><postback>WaitForDigitInTimer <star/></postback></timer></oob>
								</li>
							</condition>
						</li>
					</condition>
				</li>
			</condition>
		</template>
	</category>
	<category>
		<pattern>OOB Tick WaitForDigitInTimer *</pattern>
		<template><srai>WaitForDigitInTimerDone <star/></srai></template>
	</category>
</aiml>
